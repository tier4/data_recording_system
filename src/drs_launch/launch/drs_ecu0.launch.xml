<launch>
  <arg name="vehicle_id" default="default"/>
  <arg name="live_sensor" default="True"/>

  <let name="param_root_dir" value="$(find-pkg-share individual_params)/config/$(var vehicle_id)"/>

  <!-- trigger -->
  <group if="$(var live_sensor)">
    <node pkg="sensor_trigger" exec="sensor_trigger_exe" name="sensor_trigger">
      <param from="$(var param_root_dir)/ecu0_trigger.param.yaml"/>
    </node>
  </group>

  <!-- camera0 -->
  <include file="$(find-pkg-share drs_launch)/launch/component/drs_camera.launch.xml">
    <arg name="camera_id" value="0"/>
    <arg name="param_root_dir" value="$(var param_root_dir)"/>
    <arg name="live_sensor" value="$(var live_sensor)"/>
  </include>
  <node pkg="c2_readout_delay_setter" exec="c2_readout_delay_setter" name="readout_setter_0"
        namespace="sensing/camera/camera0">
    <param from="$(var param_root_dir)/camera0/readout_delay.param.yaml"/>
    <param name="target_v4l2_node" value="v4l2_camera"/>
  </node>

  <!-- camera1 -->
  <include file="$(find-pkg-share drs_launch)/launch/component/drs_camera.launch.xml">
    <arg name="camera_id" value="1"/>
    <arg name="param_root_dir" value="$(var param_root_dir)"/>
    <arg name="live_sensor" value="$(var live_sensor)"/>
  </include>
  <node pkg="c2_readout_delay_setter" exec="c2_readout_delay_setter" name="readout_setter_1"
        namespace="sensing/camera/camera1">
    <param from="$(var param_root_dir)/camera1/readout_delay.param.yaml"/>
    <param name="target_v4l2_node" value="v4l2_camera"/>
  </node>

  <!-- camera2 -->
  <include file="$(find-pkg-share drs_launch)/launch/component/drs_camera.launch.xml">
    <arg name="camera_id" value="2"/>
    <arg name="param_root_dir" value="$(var param_root_dir)"/>
    <arg name="live_sensor" value="$(var live_sensor)"/>
  </include>
  <node pkg="c2_readout_delay_setter" exec="c2_readout_delay_setter" name="readout_setter_2"
        namespace="sensing/camera/camera2">
    <param from="$(var param_root_dir)/camera2/readout_delay.param.yaml"/>
    <param name="target_v4l2_node" value="v4l2_camera"/>
  </node>

  <!-- camera3 -->
  <include file="$(find-pkg-share drs_launch)/launch/component/drs_camera.launch.xml">
    <arg name="camera_id" value="3"/>
    <arg name="param_root_dir" value="$(var param_root_dir)"/>
    <arg name="live_sensor" value="$(var live_sensor)"/>
  </include>
  <node pkg="c2_readout_delay_setter" exec="c2_readout_delay_setter" name="readout_setter_3"
        namespace="sensing/camera/camera3">
    <param from="$(var param_root_dir)/camera3/readout_delay.param.yaml"/>
    <param name="target_v4l2_node" value="v4l2_camera"/>
  </node>

  <!-- front LiDAR -->
  <include file="$(find-pkg-share drs_launch)/launch/component/drs_aeva.launch.xml">
    <arg name="lidar_position" value="front"/>
    <arg name="lidar_model" value="Aeries2"/>
    <arg name="live_sensor" value="$(var live_sensor)"/>
  </include>

  <!-- right LiDAR -->
  <include file="$(find-pkg-share drs_launch)/launch/component/drs_seyond.launch.xml">
    <arg name="lidar_position" value="right"/>
    <arg name="lidar_model" value="RobinW"/>
    <arg name="live_sensor" value="$(var live_sensor)"/>
    <arg name="sensor_ip" value="192.168.3.203"/>
    <arg name="host_ip" value="192.168.3.1"/>
  </include>

  <!-- CAN -->
  <!-- vehicle interface -->
  <group if="$(var live_sensor)">
    <include file="$(find-pkg-share drs_launch)/launch/component/can_interface.launch.xml">
      <arg name="vehicle_id" value="$(var vehicle_id)"/>
    </include>
  </group>

  <!-- IMU -->
  <include file="$(find-pkg-share drs_launch)/launch/component/imu.launch.xml">
    <arg name="launch_driver" value="$(var live_sensor)"/>
  </include>

  <!-- topic monitor -->
  <node pkg="ros_topic_monitor" exec="ros_topic_monitor">
    <remap from="statistics" to="/ecu1/statistics"/>
    <param name="topic_list" value="/opt/drs/record_topics_ecu0.yaml"/>
  </node>
</launch>
